#version 150

in vec3 position;
in vec2 textureCoordinates;
in vec3 normal;

out vec2 pass_textureCoordinates;
out vec3 surfaceNormal;
out vec3 toLightVector;
out vec3 toCameraVector;
out vec4 shadowCoords;

uniform mat4 transformationMatrix;
uniform mat4 projectionMatrix;
uniform mat4 viewMatrix;
uniform mat4 toShadowMapSpace;
uniform vec3 lightDirection;
uniform vec3 cameraPosition;
uniform float numberOfRows;
uniform vec2 offset;
uniform vec4 plane;

void main(void) {
    vec4 worldPos = transformationMatrix * vec4(position, 1.0);

    // Shadow coords
    shadowCoords = toShadowMapSpace * worldPos;

    gl_ClipDistance[0] = dot(worldPos, plane);

    vec4 posRelativeToCamera = viewMatrix * worldPos;
    gl_Position = projectionMatrix * posRelativeToCamera;

    pass_textureCoordinates = (textureCoordinates / numberOfRows) + offset;

    // Normals
    mat3 normalMatrix = mat3(transpose(inverse(transformationMatrix)));
    surfaceNormal = normalize(normalMatrix * normal);

    toLightVector = normalize(lightDirection);
    toCameraVector = normalize(cameraPosition - worldPos.xyz);
}
